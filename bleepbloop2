#include <Arduino.h>

#include <QTRSensors.h>

QTRSensors qtr;

class sensorData {
    public:
    int size=3;
    sensorData() {
      qtr.setTypeRC(); // or setTypeAnalog()
    qtr.setSensorPins((const uint8_t[]){A0, A1, A2}, 3);
    for (uint8_t i = 0; i < 250; i++)
    {qtr.calibrate();
        delay(20);
        }

    }

    float seData() {
        float avik=10; //Denne vi endrer for å lese
        
        return avik;
    }

    void update() {
        analogWrite(A0,HIGH); // VELDIG VELDIG , må gjøre det for hver av sensorene
        analogWrite(A2,HIGH);
        
        //analogWrite(1,HIGH);
        //analogWrite(2,HIGH);
        uint16_t sensors[size];
        int16_t position = qtr.readLineBlack(sensors);
        for (uint8_t i = 0; i < size; i++)
        {
            Serial.print(sensors[i]);
            if (i < 2) Serial.print(", ");
        }
        Serial.println("");
    }
};


//tilstandsmaskinnnn
float input = 100;
bool serLinje = false;

float forgjeAvik = 0.0;
float integral = 0.0;
float deriverte=0.0;

float K_P = 10;
float K_I = 10;
float K_D = 10;



float PID2(float avik) {
    integral += avik;
    float derivative = avik - forgjeAvik;
    float output = K_P * avik + K_I * integral + K_D * derivative;
    forgjeAvik = avik;
    return output;
}




void setup() {
    Serial.begin(9600); // Start serial communication
    
    Serial.println("Calibration complete!");
}

float flag=0;
sensorData sensor;

void loop() {
    sensor.update();
    sensor.seData();
}
